# 2025-12-01 JavaScript授業ノート

**授業日時**: 2025年12月1日
**科目**: JavaScript
**教科書**: 1冊ですべて身につくJavaScript入門講座
**範囲**: Chapter 4-13 〜 4-16, Chapter 5-1 〜 5-4 (P130〜P163)

***

## 学んだ内容

### Chapter 4: イベントで動かしてみよう(完了)

#### Chapter 4-13: ページのスクロール量を表示しよう

スクロール進捗を表示するプログレスバーの実装を学習しました。

**実装内容**:

- ページ上部に固定のプログレスバーを配置
- スクロール量に応じてバーの幅が0%〜100%に変化
- HTMLに`id="bar"`の要素を作成
- CSSで`position: fixed`を使用して画面最上部に固定

**ポイント**:

- プログレスバーで記事の読了率を視覚的に表示
- ユーザビリティの向上

***

#### Chapter 4-14: スクロール量を取得しよう

スクロールイベントを監視して現在のスクロール位置を取得する方法を学習しました。

**重要なプロパティ**:

```javascript
window.scrollY  // 縦方向のスクロール量(推奨)
window.pageYOffset  // scrollYの別名(後方互換性)
```

**コード例**:

```javascript
window.addEventListener('scroll', () => {
  const scrollAmount = window.scrollY;
  console.log('現在のスクロール量:', scrollAmount);
});
```

**ポイント**:

- `window.scrollY`は現在のスクロール位置をピクセル単位で返す
- サブピクセル精度に対応しているため整数値とは限らない

***

#### Chapter 4-15: ページのサイズを取得しよう

進捗率を計算するために必要なページ全体の高さと表示領域の高さを取得する方法を学習しました。

**必要な値**:

```javascript
// ページ全体の高さ
const pageHeight = document.documentElement.scrollHeight;

// 表示領域(ビューポート)の高さ
const viewportHeight = document.documentElement.clientHeight;

// スクロール可能な高さ
const scrollableHeight = pageHeight - viewportHeight;
```

**重要な概念**:

- `scrollHeight`: 表示域を含むコンテンツ全体の高さ
- `clientHeight`: 現在表示されているウィンドウの高さ
- スクロール可能な範囲 = ページ全体の高さ - 表示領域の高さ

***

#### Chapter 4-16: 計算式を書いてみよう

スクロール量とページサイズから進捗率(0〜100%)を計算する方法を学習しました。

**計算式**:

```javascript
const progress = (scrollY / scrollableHeight) * 100;

// 完全な計算式
const progress = (window.scrollY / (document.documentElement.scrollHeight - document.documentElement.clientHeight)) * 100;
```

**実装例**:

```javascript
const getScrollPercent = () => {
  const scrolled = window.scrollY;
  const pageHeight = document.documentElement.scrollHeight;
  const viewHeight = document.documentElement.clientHeight;
  const percentage = Math.round(scrolled / (pageHeight - viewHeight) * 100);
  
  document.querySelector('#bar').style.width = `${percentage}%`;
}

window.addEventListener('scroll', getScrollPercent);
```

**ポイント**:

- `Math.round()`で小数点以下を四捨五入
- JavaScriptでは算数記号が使えるため四則演算が可能

***

#### COLUMN: 論理演算子

**\&\& (AND: なおかつ)**:

```javascript
const hour = 9;
if(hour >= 9 && hour < 12){
    console.log('モーニング会員');
}
```

**|| (OR: または)**:

```javascript
const hour = 23;
if(hour === 8 || hour === 23){
    console.log('早朝&夜間会員');
}
```

**ショートサーキット効果**:

- AND: 左側が`false`なら右側を評価しない
- OR: 左側が`true`なら右側を評価しない

**複数の論理演算子の連結**:

```javascript
if(xxx === yyy && zzz > aaa && bbb < ccc){
    // すべての条件を満たす場合
}
```

⚠️ 注意: あまり長く繋げるとわかりにくくなる

***

#### 講師からのアドバイス

**スクロールイベントのパフォーマンス**:

- スクロールイベントは非常に頻繁に発生する
- パフォーマンス改善のため**デバウンス(debounce)**を使用すべき
- 次のChapterで実装予定

**スマホでの確認方法**:

- Live Serverの設定で`Use Local IP`を有効化
- ブラウザのURLをQRコード化してスマホで開く
- 実機でスクロール動作を確認できる

**プロパティの調べ方(2本立て)**:

1. MDN公式ドキュメントで当たりをつける
2. ブラウザDevToolsで実際に触って確認
```javascript
// DevToolsで実行
console.dir(window);
console.dir(document.documentElement);
```

**デバッグ用コンソールコマンド**:

```javascript
// イベントを1行で確認
window.addEventListener('scroll', () => console.log(window.scrollY));

// すべてのイベントを監視(Chrome DevTools)
monitorEvents(window);
unmonitorEvents(window);  // 監視停止

// イベントオブジェクトの全内容を表示
window.addEventListener('scroll', console.log);
```


***

### Chapter 5: 複数のデータを使ってみよう!

#### Chapter 5-1: 作成する画像一覧ページの紹介

フルーツジュースのメニュー一覧ページを作成します。JavaScriptに画像やテキストの情報を記述し、ページに表示させる流れを学習します。

***

#### Chapter 5-2: insertAdjacentHTMLでHTMLタグを挿入しよう

JavaScriptでHTMLタグを含むコンテンツを挿入する方法を学習しました。

**基本構文**:

```javascript
element.insertAdjacentHTML(position, text);
```

**4つの位置指定**:

```html
<!-- beforebegin -->
<div id="target">
  <!-- afterbegin -->
  既存のコンテンツ
  <!-- beforeend -->
</div>
<!-- afterend -->
```

- `beforebegin`: 要素の前(外側)
- `afterbegin`: 要素の中の最初(内側)
- `beforeend`: 要素の中の最後(内側) ← 今回使用
- `afterend`: 要素の後(外側)

**実装例**:

```javascript
const menu = document.querySelector('#menu');
menu.insertAdjacentHTML('beforeend', '<p>挿入されました</p>');
```

**⚠️ 重要な注意**:

- `innerHTML`は既存のHTML要素をすべて削除してしまう
- イベントリスナーも消えてしまう
- テキストのみの場合は`textContent`を使用
- HTMLを追加する場合は`insertAdjacentHTML`を使用(推奨)

***

#### Chapter 5-3: 配列で複数の画像のファイル名をまとめよう

複数のデータを効率的に管理するための**配列**を学習しました。

**配列とは**:

- 複数のデータを1つの定数にまとめて管理できる
- 仕切りのついた箱のようなもの
- 各要素には0から始まるインデックス番号が割り振られる

**配列の書き方**:

```javascript
const lists = [
    'apple.jpg',
    'fig.jpg',
    'lemon.jpg',
    'lime.jpg',
    'mango.jpg',
    'strawberry.jpg',
]
```

**配列の構造**:

```
要素      → ['apple.jpg', 'fig.jpg', 'lemon.jpg', ...]
インデックス →     0           1           2        ...
```

**テンプレートリテラルで配列を使用**:

```javascript
const content = `
    <div><img src="images/${lists[0]}" alt=""></div>
    <div><img src="images/${lists[1]}" alt=""></div>
    <div><img src="images/${lists[2]}" alt=""></div>
    <div><img src="images/${lists[3]}" alt=""></div>
    <div><img src="images/${lists[4]}" alt=""></div>
    <div><img src="images/${lists[5]}" alt=""></div>
`;
```

**ポイント**:

- 角カッコ`[ ]`で配列を作成
- 要素はカンマで区切る
- インデックスは0から始まる

***

#### Chapter 5-4: 配列の中にある画像を表示しよう

配列の要素を取り出す方法を学習しました。

**要素の取り出し方**:

```javascript
配列[インデックス]

// 例
lists[0]  // 'apple.jpg'
lists[5]  // 'strawberry.jpg'
lists[6]  // undefined (存在しない)
```

**重要ポイント**:

- インデックスは0から始まる
- 存在しないインデックスは`undefined`

***

#### COLUMN: varは古い変数の指定方法

- ES2015(ES6)以前は`var`が使われていた
- 現在は`const`と`let`を使用すべき
- `var`は厳密には扱い方が異なり問題がある

***

#### COLUMN: 配列を操作するメソッド

配列を操作する主要なメソッドを学習しました。

**破壊的メソッド**(元の配列を変更):


| メソッド | 説明 | 例 |
| :-- | :-- | :-- |
| `pop()` | 最後の要素を削除して返す | `lists.pop()` |
| `push(要素)` | 最後に要素を追加 | `lists.push('orange.jpg')` |
| `shift()` | 最初の要素を削除して返す | `lists.shift()` |
| `unshift(要素)` | 最初に要素を追加 | `lists.unshift('grape.jpg')` |
| `reverse()` | 配列の順番を逆にする | `lists.reverse()` |

**非破壊的メソッド**(新しい値を返す):


| メソッド | 説明 | 例 |
| :-- | :-- | :-- |
| `join(区切り文字)` | 配列を文字列に変換 | `lists.join('/')` |
| `split(区切り文字)` | 文字列を配列に変換 | `'a/b/c'.split('/')` |

**実験コード**:

```javascript
console.log(lists);
const pop = lists.pop();
console.log(pop);
lists.push('orange.jpg');
console.log(lists);
lists.shift();
console.log(lists);
lists.unshift('grape.jpg');
console.log(lists);
lists.reverse();
console.log(lists);
console.log(lists.join('/'));
console.log(lists.join('/').split('/'));
lists.forEach(data => console.log(data));
```


***

#### 講師補足: スタックとヒープ

JavaScriptでは、データ型によってメモリの管理方法が異なります。

**スタック(Stack)**:

- プリミティブ型(基本型)のデータが格納される
- 値そのものが直接保存される
- 代入時に**値がコピー**される

**対象データ型**:

- 文字列(String)
- 数値(Number)
- ブール値(Boolean)
- など

**例**:

```javascript
let x = 12;
let y = x;  // xの値(12)がコピーされる
x = 8;      // xを変更してもyには影響しない
console.log(y);  // 12 (変わらない)
```


***

**ヒープ(Heap)**:

- 参照型のデータが格納される
- メモリ上のアドレス(参照)が保存される
- 代入時に**参照が渡される**(参照渡し)

**対象データ型**:

- 配列(Array)
- オブジェクト(Object)
- など

**例**:

```javascript
let a = [1, 2, 3];
let b = a;  // aの参照(メモリアドレス)がbにコピーされる
a[0] = 4;   // aを変更するとbも影響を受ける
console.log(b);  // [4, 2, 3] (bも変わる!)

// 新しい配列を代入
a = [4, 5, 6];
console.log(a);  // [4, 5, 6]
console.log(b);  // [4, 2, 3] (bは元の配列を参照している)
```


***

**重要ポイント**:


| 特徴 | スタック(プリミティブ型) | ヒープ(参照型) |
| :-- | :-- | :-- |
| データ型 | 文字列、数値、ブール値 | 配列、オブジェクト |
| 代入方法 | 値のコピー | 参照渡し |
| 変更の影響 | 元の変数に影響しない | 元の変数にも影響する |

**実用例**:

```javascript
// プリミティブ型(値のコピー)
let str1 = "hello";
let str2 = str1;
str1 = "world";
console.log(str2);  // "hello" (変わらない)

// 参照型(参照渡し)
let arr1 = [1, 2, 3];
let arr2 = arr1;
arr1.push(4);
console.log(arr2);  // [1, 2, 3, 4] (arr2も変わる!)

// 配列をコピーしたい場合
let arr3 = [...arr1];  // スプレッド構文で値をコピー
arr1.push(5);
console.log(arr3);  // [1, 2, 3, 4] (変わらない)
```

この概念は配列やオブジェクトを扱う際に非常に重要です。意図しない動作を防ぐために理解しておきましょう。

***

## 完成コード

### Chapter 4: プログレスバー (script.js)

```javascript
// スクロール進捗率を計算してプログレスバーを更新する関数
const getScrollPercent = () => {
    // 現在のスクロール量(縦方向)を取得
    const scrolled = window.scrollY;
    
    // スクロール量をコンソールに表示(デバッグ用)
    console.log(`${scrolled} スクロールされました`);
    
    // ページ全体の高さを取得(スクロール可能な全コンテンツの高さ)
    const pageHeight = document.documentElement.scrollHeight;
    
    // ビューポート(表示領域)の高さを取得
    const viewHeight = document.documentElement.clientHeight;
    
    // スクロールした割合を計算(0〜100%)
    // Math.round()で小数点以下を四捨五入して整数化
    const percentage = Math.round(scrolled / (pageHeight - viewHeight) * 100);
    
    // 計算した進捗率をコンソールに表示(デバッグ用)
    console.log(percentage);
    
    // プログレスバーの幅を進捗率に合わせて更新
    bar.style.width = `${percentage}%`;
}

// スクロールイベントが発生するたびにgetScrollPercent関数を実行
window.addEventListener('scroll', getScrollPercent);
```


### Chapter 5: 画像一覧ページ

#### HTML (index.html)

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Juice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Fruit Juice</h1>
    <div id="menu"></div>
    <script src="script.js"></script>
</body>
</html>
```


#### CSS (style.css)

```css
@charset "UTF-8";

/* 全体のスタイル */
body {
    text-align: center;  /* 中央揃え */
    font-family: 'Kiwi Maru', serif;  /* Google Fontsのフォント指定 */
}

/* メニューコンテナのグリッドレイアウト */
#menu {
    display: grid;  /* グリッドレイアウトを使用 */
    gap: 30px;  /* グリッドアイテム間の隙間 */
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));  /* レスポンシブなカラム設定 */
    /* auto-fit: 利用可能なスペースに自動でフィット */
    /* minmax(300px, 1fr): 最小300px、最大1frで均等配置 */
    max-width: 1020px;  /* 最大幅を1020pxに制限 */
    margin: auto;  /* 左右中央揃え */
    padding: 30px;  /* 内側の余白 */
}

/* 画像のスタイル */
img {
    width: 100%;  /* 親要素の幅いっぱいに表示 */
    aspect-ratio: 4 / 3;  /* アスペクト比を4:3に固定 */
    object-fit: cover;  /* 画像をトリミングして枠に収める */
}

/* メインタイトル(h1)のスタイル */
h1 {
    margin: 30px 0;  /* 上下30pxの余白 */
    font-size: 40px;  /* フォントサイズ */
}

/* サブタイトル(h2)のスタイル */
h2 {
    margin-top: 6px;  /* 上部に6pxの余白 */
}
```


#### JavaScript (script.js)

```javascript
// 【Chapter 5-2】insertAdjacentHTMLでHTMLタグを挿入
// id="menu"の要素を取得
const menu = document.querySelector('#menu');

// 【Chapter 5-3】画像ファイル名を配列で管理
// 6つの画像ファイル名を配列にまとめている
// インデックス: apple.jpg=0, fig.jpg=1, lemon.jpg=2, lime.jpg=3, mango.jpg=4, strawberry.jpg=5
const lists = [
    'apple.jpg',
    'fig.jpg',
    'lemon.jpg',
    'lime.jpg',
    'mango.jpg',
    'strawberry.jpg',
]

// 【Chapter 5-4】配列の中にある要素を取り出す
// テンプレートリテラル(`バッククォート`)を使用してHTMLを生成
// ${lists[インデックス]}で配列の各要素を取り出してパスに埋め込む
// 配列のインデックスは0から始まるので、lists[0]〜lists[5]で6つの要素すべてにアクセス
const content = `<div><img src="images/${lists[0]}" alt=""></div>
    <div><img src="images/${lists[1]}" alt=""></div>
    <div><img src="images/${lists[2]}" alt=""></div>
    <div><img src="images/${lists[3]}" alt=""></div>
    <div><img src="images/${lists[4]}" alt=""></div>
    <div><img src="images/${lists[5]}" alt=""></div>
`;

// #menuの内側の最後にHTMLコンテンツを挿入
// 'beforeend' = 要素の中の最後に追加
// 配列から取り出した6つの画像がすべて表示される
menu.insertAdjacentHTML('beforeend', content);
```


***

## 参考リンク

- [Window: scrollY プロパティ - MDN](https://developer.mozilla.org/ja/docs/Web/API/Window/scrollY)
- [Document: documentElement プロパティ - MDN](https://developer.mozilla.org/ja/docs/Web/API/Document/documentElement)
- [Element: scrollHeight プロパティ - MDN](https://developer.mozilla.org/ja/docs/Web/API/Element/scrollHeight)
- [Element: clientHeight プロパティ - MDN](https://developer.mozilla.org/ja/docs/Web/API/Element/clientHeight)
- [Array - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array)
- [Chrome DevTools - DOM](https://developer.chrome.com/docs/devtools/dom)

***

## 疑問点・復習ポイント

- [ ] デバウンス(debounce)の実装方法
- [ ] 配列の繰り返し処理(for文、forEach)
- [ ] スタックとヒープの詳細な動作
- [ ] スプレッド構文による配列のコピー
- [ ] レスポンシブデザインでのグリッドレイアウト
- [ ] `aspect-ratio`と`object-fit`の使い分け

***

## 試験情報

**考査範囲**: Chapter 4まで(イベント)の内容

***

## 次回予定

Chapter 5-5以降の内容

- 配列の繰り返し処理
- より効率的なコードの書き方

---
