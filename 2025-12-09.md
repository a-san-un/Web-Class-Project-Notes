# 2025-12-09 JavaScript授業ノート（Chapter7-9〜7-11 / モーダル）

## 授業情報

- 日時：2025-12-09
- 科目：JavaScript（Webデザイン基礎テキスト Chapter7-9〜7-11＋講師オリジナル課題）
- 主なテーマ：スライドメニューのアニメーション、モーダルウィンドウ、タイマー＋sessionStorageによる表示制御[^4][^1]

***

## 学んだこと

### スライドメニュー（Chapter7-9〜7-11）

- CSSの`translate`プロパティと`height: 100vh`を使って、画面右側に隠れているメニューパネルを右外（`translate: 100vw`）から本来の位置（`0`）へアニメーションさせるスライドメニューを実装した。[^3]
- `Element.animate()`（Web Animations API）で、メニューパネルの`translate`と、各メニュー項目`<li>`の`opacity`・`translate`を制御し、「パネルがスライド→項目が上から順番にフェードイン」という動きを作った。[^2][^5]
- 閉じるときに各`<li>`を`opacity: [1, 0]`でフェードアウトさせ、2回目以降に開いたときも最初は透明からアニメーションするようにして、チラつきや不自然な挙動を防いだ。[^2]


### モーダルウィンドウの基本構造（コラム）

- モーダルは「中央の白いウィンドウ（`#modal`）＋背景を暗くするマスク（`#mask`）」で構成し、両方に`opacity`と`visibility`を使ってフェードイン・フェードアウトを行う。[^6][^7]
- `#modal`は`top: 50%; left: 50%; translate: -50% -50%;`で画面中央に配置し、`#mask`は`position: fixed; inset: 0; background: rgba(0,0,0,.6);`で全画面を覆う半透明のレイヤーとして実装した。[^3][^6]

```
- Remix Icon をCDNから読み込み、`<i class="ri-close-circle-fill"></i>` を閉じるボタンに使うことで、SVGを自前で用意せずにアイコンフォントとして×ボタンを実装した。[^8][^9]
```


### タイマー＋sessionStorageで「一度だけ表示」バナー

- `setTimeout` で「x秒後に処理を実行」するタイマーを作り、その中で`modal.animate(showKeyframes, options)`と`mask.animate(showKeyframes, options)`を呼び出してバナーを一定時間後に表示する処理を書いた。[^2]
- `sessionStorage` を使い、`banner_show`というキーに「表示済みかどうか」と「有効期限（timestamp）」をJSON文字列で保存し、タブを閉じるまでの間だけ状態を保持できることを学んだ。[^10][^1]
- `sessionStorage.getItem()`で取得した文字列を`JSON.parse()`でオブジェクトに戻し、`Date.now()`と比較して有効期限内なら表示しない／期限切れなら新しいデータで上書きして再表示するロジックを実装した。[^11][^1]

***

## コード例（要点のみ）

### スライドメニュー：リンクを順番に表示

```js
// メニューの<li>をまとめて取得
const menuItems = document.querySelectorAll('#menu-panel li');

// メニューを開くとき
menuOpen.addEventListener('click', () => {
  // パネルをスライドイン
  menuPanel.animate({ translate: ['100vw', 0] }, menuOptions);

  // 各<li>を上から順にフェードイン＋スライド
  menuItems.forEach((menuItem, index) => {
    menuItem.animate(
      {
        opacity: [0, 1],       // 透明 → 不透明
        translate: ['2rem', 0] // 右から元の位置へ
      },
      {
        duration: 2400,
        easing: 'ease',
        fill: 'forwards',
        delay: 300 * index      // 上から0, 300, 600ms…と遅延
      }
    );
  });
});

// 閉じるときは<li>を透明に戻す
menuClose.addEventListener('click', () => {
  menuPanel.animate({ translate: [0, '100vw'] }, menuOptions);
  menuItems.forEach((menuItem) => {
    menuItem.animate({ opacity: [1, 0] }, menuOptions);
  });
});
```


### モーダル：タイマー＋一度だけ表示

```js
const modal = document.querySelector('#modal');
const close = document.querySelector('#close');
const mask  = document.querySelector('#mask');

const showKeyframes = { opacity: [0, 1], visibility: 'visible' };
const hideKeyframes = { opacity: [1, 0], visibility: 'hidden' };
const options = { duration: 800, easing: 'ease', fill: 'forwards' };

// x秒後にモーダルを表示
function showBanner() {
  setTimeout(() => {
    modal.animate(showKeyframes, options);
    mask.animate(showKeyframes, options);
  }, 2000);
}

// 表示情報と有効期限を作る
function setBannerData() {
  return JSON.stringify({
    show: true,
    expire: Date.now() + 10000 // 10秒後まで有効
  });
}

// 保存済みデータを取得
const isBannerShow    = sessionStorage.getItem('banner_show');
const isBannerShowObj = JSON.parse(isBannerShow);

// 初回 or 期限切れなら表示
if (!isBannerShowObj) {
  showBanner();
  sessionStorage.setItem('banner_show', setBannerData());
} else if (Date.now() > isBannerShowObj.expire) {
  sessionStorage.removeItem('banner_show');
  showBanner();
  sessionStorage.setItem('banner_show', setBannerData());
}

// 閉じるボタンとマスクでフェードアウト
close.addEventListener('click', () => {
  modal.animate(hideKeyframes, options);
  mask.animate(hideKeyframes, options);
});
mask.addEventListener('click', () => {
  close.click();
});
```


***

## 参考リンク

- Web Animations API（`Element.animate` の基本）[^5][^2]
- CSS `translate` プロパティ（位置の調整とアニメーション）[^3]
- Web Storage / sessionStorage（タブ単位での一時保存）[^1][^10]
- デモ的なモーダル実装の解説記事（CSS＋JS）[^12][^6]

***

## 疑問点・今後確認したいこと

- `sessionStorage` と `localStorage` をどのような基準で使い分けるのがよいか（有効期限を自前で管理する場合など）。[^11][^1]
- Web Animations API と CSSアニメーションのどちらを使うべきかの判断基準（ユーザー操作との連動や細かい制御のしやすさなど）。[^5][^4]
<span style="display:none">[^13][^14][^15][^16][^17][^18][^19][^20][^21][^22][^23][^24][^25]</span>

<div align="center">⁂</div>

[^1]: https://developer.mozilla.org/ja/docs/Web/API/Window/sessionStorage

[^2]: https://developer.mozilla.org/ja/docs/Web/API/Element/animate

[^3]: https://developer.mozilla.org/ja/docs/Web/CSS/translate

[^4]: https://developer.mozilla.org/ja/docs/Web/API/Web_Animations_API/Using_the_Web_Animations_API

[^5]: https://developer.mozilla.org/ja/docs/Web/API/Web_Animations_API

[^6]: https://www.digitalocean.com/community/tutorials/how-to-use-opacity-and-transparency-to-create-a-modal-in-css

[^7]: https://developer.mozilla.org/ja/docs/Web/CSS/Reference/Properties/opacity

[^8]: https://remixicon.com

[^9]: https://github.com/Remix-Design/RemixIcon

[^10]: https://developer.mozilla.org/ja/docs/Web/API/Web_Storage_API

[^11]: https://ja.javascript.info/localstorage

[^12]: https://asobi-infinity.com/blog/css-modal-implementation/

[^13]: https://developer.mozilla.org.cach3.com/ko/docs/Web/API/Window/sessionStorage

[^14]: https://mdn.org.cn/en-US/docs/Web/API/Window/sessionStorage

[^15]: https://qiita.com/uralogical/items/ade858ccfa164d164a3b

[^16]: https://web-create-kokusyo.com/javascript/sessionstorage/

[^17]: https://developer.mozilla.org/ja/docs/Web/CSS/transform-function/translate

[^18]: https://developer.mozilla.org/ja/docs/Web/API/Animation

[^19]: https://chibasyuta.org/css-translate/

[^20]: https://b-risk.jp/blog/2021/07/sessionstorage/

[^21]: https://webst8.com/code/css-transform-translate/

[^22]: https://github.com/mdn/translated-content/blob/main/files/ru/web/api/window/sessionstorage/index.md?plain=1

[^23]: https://www.webdesignleaves.com/pr/jquery/web-animation-api-basic.html

[^24]: https://web-de-asobo.net/2021/07/19/translate/

[^25]: https://devdoc.net/web/developer.mozilla.org/en-US/docs/Web/API/WindowSessionStorage.html

